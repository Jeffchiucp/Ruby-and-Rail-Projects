<% method ||= user.persisted? ? "PATCH" : "POST" %>
<% action ||= user.persisted? ? user_url(user) : users_url %>
<% button ||= user.persisted? ? "Update User"  : "Create User" %>

<form action='<%= action %>' method="POST">
  <input type='hidden' name='_method' value='<%= method %>'>
  
  <%= auth_token %>
  
  <label for="user_username">Username</label>
  <input type="text"
         name="user[username]"
         id="user_username"
         value="<%= @user.username %>">
         
  <label for="user_password">Password</label>
  <input type="password"
         name="user[password]"
         id="user_password">
         
  <input type="submit" value="<%= button %>">
</form>